# pysmeter

A package for estimating the Heat Transfer Coefficient of a domestic building using smart meter data.

## Background

**SMETER** = **S**mart **M**eter **E**nabled **T**hermal **E**fficiency **R**ating

This package was borne out of an innovation competition run by BEIS (the UK Government Department for Business, Energy and Industrial Strategy) whose aim was to find unobtrusive and cost-effective ways of determining the HTC of a domestic building using smart meter data.

The team at the [Centre for Sustainable Energy](https://cse.org.uk) developed a machine learning model which uses the following data series collected from the dwelling (all measurements are taken half-hourly):

- Average indoor temperature*
- Outdoor temperature**
- Gas kWh
- Electricity kWh

\* Readings can be taken with any good temperature logger. Loggers should be placed in as many rooms as possible and the mean taken across all rooms.

\*\* A single logger should be placed outside the dwelling within a [Stevenson screen](https://en.wikipedia.org/wiki/Stevenson_screen) to shield it from direct sunlight.

For more info on the physical setup of sensors, see the [guidance](#sensor-placement-guidance).

From these data the model produces an estimate of the HTC of the building, as would be found by performing a co-heating test. The model itself is an ensemble of convolutional neural networks built with Tensorflow.

## Installation

System requirements...

Install with pip:
```
pip install pysmeter
```

It is recommended that you use a virtual env. Python >= 3.3 ships with venv in the standard library, so you can do:
```
python3 -m venv /path/to/new/virtual/environment
```
```
cd /path/to/new/virtual/environment
```
```
source bin/activate
```
```
pip install pysmeter
```

The install does not include the model files themselves, as they are very large (~150MB). These need to be downloaded separately after installation:
```
python3 -m pysmeter.download_model
```

## Usage

It is generally expected that you will use pysmeter within an existing Python project. The package exposes a single function, `pysmeter.model.predict`, which makes and HTC prediction based on the input array. The input array can be either two-dimensional (if there is only one building) or three-dimensional (more than one building). The dimensions are:

 - [_number of houses_ x] _timesteps_ x _channels_

There are always four channels: indoor temp, outdoor temp, gas, elec.

The predict function returns a list of predictions for each of the datasets it is given, where each prediction is a tuple containing the prediction itself, the lower bound and the upper bound.

```python
import pysmeter.model as smeter

X = <code to make input array>

# Make the predictions
predictions = smeter.predict(X)

for htc, lower, upper in predictions:
    print(f"HTC: {htc} | Lower bound: {lower} | Upper bound: {upper}")
```

Here is a more illustrative example where we assume that we have two buildings whose data series are stored in the files `data1.csv` and `data2.csv`, where the csv files have headers `indoor, outdoor, gas, elec`.
```python
import csv
import numpy as np
import pysmeter.model as smeter

def _read_data(file_path):
    """Reads data from file and returns 4 lists containing the data for each channel."""
    indoor, outdoor, gas, elec = [], [], [], []

    with open(file_path) as f:
        reader = csv.DictReader(f)
        for row in reader:
            indoor.append(float(row["indoor"]))
            outdoor.append(float(row["outdoor"]))
            gas.append(float(row["gas"]))
            elec.append(float(row["elec"]))

    return indoor, outdoor, gas, elec

x1 = _read_data("data1.csv")
x2 = _read_data("data2.csv")

# Put the data into a numpy array and make it the right shape
X = np.array([x1, x2]).transpose((0, 2, 1))

# Make the predictions
predictions = smeter.predict(X)

for htc, lower, upper in predictions:
    print(f"HTC: {htc} | Lower bound: {lower} | Upper bound: {upper}")
```

## Limitations

The primary limitation of the model is that it has been trained on simulated data. Due to the high cost of performing co-heating tests, very few have been performed on UK houses - fewer still where the required sensor and smart meter data has been collected. As a result, the training set was generated from simulations of houses based on [English Housing Survey](https://www.gov.uk/government/collections/english-housing-survey) data, using the [EnergyPlus](https://energyplus.net/) building energy modelling programme. Labels for the data were generated by creating simulated coheating tests in EnergyPlus.

<< Link to simulation repo? >>

A related limitation is that the SMETER model has only been validated on a small number of real test cases.

<< Table of results >>

All of the test houses were semi-detached with gas central heating, located in the north of England.

It should be noted that the SMETER model is only designed to work with houses heated by a gas central heating system, since these make up the majority of the UK housing stock.



## Sensor placement guidance

TODO
